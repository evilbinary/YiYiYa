# coding:utf-8
# *******************************************************************
# * Copyright 2021-2080 evilbinary
# * 作者: evilbinary on 01/01/20
# * 邮箱: rootdebug@163.com
# ********************************************************************
import os

Import('env')


env = env.Clone(
    w=GetOption('w'),
    ENV=os.environ,
    PATH=[os.environ['PATH'], '/opt/local/bin'],
)

source = [
    'test.c',
]

libs = [
    'libcmocka.a',
    'libc.a'
]


env.Program('test', source,
            LIBS=env.get('LIBS')+libs,
            CFLAGS='$CFLAGS $LIBCFLAGS',
            LINKFLAGS='$LINKFLAGS $USER')

if env.get('DEFAULT_LIBC') == 'libmusl':
    source = [
        'test-musl.c',
    ]
    if env.get('MYLIB'):
        source.append(env.get('MYLIB'))

    env.Program('test-musl', source,
                LIBS=env.get('LIBS')+libs,
                CFLAGS='$CFLAGS $LIBCFLAGS',
                LINKFLAGS='$LINKFLAGS $USER')


source = [
    'test-file.c',
]

env.Program('test-file', source,
            LIBS=env.get('LIBS')+libs,

            CFLAGS='$CFLAGS $LIBCFLAGS ',
            LINKFLAGS='$LINKFLAGS $USER')


source = [
    'test-mem.c',
]


env.Program('test-mem', source,
            LIBS=env.get('LIBS')+libs,

            CFLAGS='$CFLAGS $LIBCFLAGS ',
            LINKFLAGS='$LINKFLAGS $USER')


source = [
    'test-uncompress.c',
]


cflags = ''

env.Program('test-uncompress', source,
            LIBS=env.get('LIBS')+libs+[
            'libzlib.a',
            'liblz4.a',
            'libuuid.a',
            'libcmocka.a',
            ],
            CFLAGS='$CFLAGS $LIBCFLAGS',
            LINKFLAGS='$LINKFLAGS $USER')


source = [
    'test-string.c',
]

env.Program('test-string', source,
            LIBS=env.get('LIBS')+libs,
            CFLAGS='$CFLAGS $LIBCFLAGS ',
            LINKFLAGS='$LINKFLAGS $USER')


source = [
    'test-stdlib.c',
]


env.Program('test-stdlib', source,
            LIBS=env.get('LIBS')+libs,

            CFLAGS='$CFLAGS $LIBCFLAGS',
            LINKFLAGS='$LINKFLAGS $USER')


source = [
    'test-stdio.c',
]

env.Program('test-stdio', source,
            LIBS=env.get('LIBS')+libs,
            CFLAGS='$CFLAGS $LIBCFLAGS',
            LINKFLAGS='$LINKFLAGS $USER')
